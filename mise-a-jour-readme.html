<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.8.1 from src\site\markdown/mise-a-jour-readme.md at 2021-06-09
 | Rendered using Apache Maven Fluido Skin 1.7
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="fr" lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Date-Revision-yyyymmdd" content="20210609" />
    <meta http-equiv="Content-Language" content="fr" />
    <title>TumoroteK &#x2013; Mise à jour de TumoroteK version 2.2.3</title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-1.7.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />
    <script type="text/javascript" src="./js/apache-maven-fluido-1.7.min.js"></script>
<link rel="icon" href="images/favicon.ico">
            <script defer src="https://use.fontawesome.com/releases/v5.2.0/js/all.js" integrity="sha384-4oV5EgaV02iISL2ban6c/RmotsABqE4yZxZLcYMAdG7FAPsyHYAPpywE9PJo+Khy" crossorigin="anonymous"></script>
            <script>
                window.onload = function() {
                    document.querySelectorAll('[title="GitHub"]')[0].href = "https://github.com/TumoroteK/TumoroteK";
                    document.querySelectorAll('[title="Liste des versions"]')[0].href = "https://github.com/TumoroteK/TumoroteK/releases";
                    document.querySelectorAll('[title="Dossier d\'installation"]')[0].href = "https://github.com/TumoroteK/TumoroteK/releases/download/v2.2.3/tumorotek-install-2.2.3.zip";
                };
            </script>
  </head>
  <body class="topBarDisabled">
    <div class="container-fluid">
      <div id="banner">
        <div class="pull-left"><a href="https://tumorotek.github.io/TumoroteK" id="bannerLeft"><img src="images/logo_tumo.png"  alt="TumoroteK"/></a></div>
        <div class="pull-right"></div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
      <li class=""><a href="./" title="Liste des versions">Liste des versions</a><span class="divider">/</span></li>
    <li class="active ">Mise à jour de TumoroteK version 2.2.3</li>
        <li id="publishDate" class="pull-right"><span class="divider">|</span> Dernière publication: 2021-06-09</li>
          <li id="projectVersion" class="pull-right"><span class="divider">|</span>Version: 2.2.3</li>
      <li class="pull-right"><a href="./" title="GitHub"><img class="imageLink" src="images/GitHub-Mark-32px.png" alt="" width="14px"/>GitHub</a></li>
        </ul>
      </div>
      <div class="row-fluid">
        <div id="leftColumn" class="span2">
          <div class="well sidebar-nav">
    <ul class="nav nav-list">
      <li class="nav-header">TumoroteK</li>
    <li><a href="note-version.html" title="Notes de version"><span class="none"></span>Notes de version</a></li>
    <li><a href="TumoroteK-Manuel.pdf" title="Manuel d'utilisation"><span class="none"></span>Manuel d'utilisation</a></li>
      <li class="nav-header">Procédures</li>
    <li><a href="installation-readme.html" title="Installation"><span class="none"></span>Installation</a></li>
    <li><a href="installation-readme-old.html" title="Ancienne installation"><span class="none"></span>Ancienne installation</a></li>
    <li class="active"><a href="#"><span class="none"></span>Mise à jour</a></li>
      <li class="nav-header">Ressources</li>
    <li><a href="" title="Dossier d'installation"><span class="none"></span>Dossier d'installation</a></li>
    <li><a href="TumoroteK-DossierExploitation.pdf" title="Dossier d'exploitation"><span class="none"></span>Dossier d'exploitation</a></li>
    <li><a href="TumoroteK-InterfaçagesSGL.pdf" title="Dossier sur les interfaçages avec des SGL"><span class="none"></span>Dossier sur les interfaçages avec des SGL</a></li>
    <li><a href="Installation_parametrage_HCL_V2.pdf" title="Note d'installation et de paramétrage VisionMate©"><span class="none"></span>Note d'installation et de paramétrage VisionMate©</a></li>
</ul>
          <hr />
          <div id="poweredBy">
            <div class="clear"></div>
            <div class="clear"></div>
            <div class="clear"></div>
            <div class="clear"></div>
<a href="http://www.aphp.fr" title="AP-HP" class="builtBy"><img class="builtBy"  alt="AP-HP" src="images/aphp-new.png"    /></a>
            </div>
          </div>
        </div>
        <div id="bodyColumn"  class="span10" >
<div class="section">
<div class="section">
<div class="section">
<h4><a name="Mise_.C3.A0_jour_de_TumoroteK_version_2.2.3"></a>Mise &#xe0; jour de TumoroteK version 2.2.3</h4>
<p><img src="https://img.shields.io/badge/TumoroteK-2.2.3-brightgreen.svg" alt="TumoroteK version 2.2.3" title="TumoroteK version 2.2.3" /> <img src="https://img.shields.io/badge/Java-&gt;=_8-blue.svg" alt="Java version 8" title="Java version 8" /> <img src="https://img.shields.io/badge/Apache_Tomcat-&gt;=_7-yellow.svg" alt="Apache Tomcat version 7" title="Apache Tomcat version 7" /></p>
<p><b><span class="fas fa-exclamation-triangle" aria-hidden="true"></span> Utiliser ce README uniquement pour mettre &#xe0; jour l&#x2019;application depuis la version 2.1.1 ou sup&#xe9;rieure.</b></p><hr />
<div class="section">
<h5><a name="A._Modification_du_param.C3.A9trage_du_serveur_Tomcat_pour_utiliser_Java_8"></a>A. Modification du param&#xe9;trage du serveur Tomcat pour utiliser Java 8</h5>
<ol style="list-style-type: decimal">

<li>

<p>Arr&#xea;ter le service Apache Tomcat (pr&#xe9;voir avec vos utilisateurs une heure d&#x2019;interruption)</p>
</li>
<li>

<p>Ajouter ou modifier la variable <tt>JAVA_HOME</tt> en y indiquant le chemin vers Java 8</p>
<p>Exemple dans le fichier <tt>setenv.sh</tt> :</p>

<div>
<div>
<pre class="source">export JAVA_HOME=/opt/java8
</pre></div></div>
</li>
</ol></div>
<div class="section">
<h5><a name="B._Mise_.C3.A0_jour_de_l.E2.80.99application"></a>B. Mise &#xe0; jour de l&#x2019;application</h5>
<blockquote>

<p>Pr&#xe9;f&#xe9;rer la mise &#xe0; jour dans des p&#xe9;riodes creuses.<br />
La mise &#xe0; jour est cens&#xe9;e &#xea;tre transparente pour les utilisateurs :<br />
Une fois effectu&#xe9;e, ils seront automatiquement redirig&#xe9;s vers la nouvelle version lors d&#x2019;une reconnexion.</p>
</blockquote>
<ol style="list-style-type: decimal">

<li>

<p>Aller dans le dossier <tt>&lt;PATH_TOMCAT&gt;/conf/Catalina/localhost</tt></p>
</li>
<li>

<p><b>Dupliquer</b> le fichier <tt>tumorotek##x.x.x.xml</tt>.<br />
Renommer la copie en :</p>

<div>
<div>
<pre class="source">tumorotek##2.2.3.xml
</pre></div></div>
</li>
<li>

<p>Modifier dans ce m&#xea;me fichier <tt>tumorotek##2.2.3.xml</tt>, les variables suivantes :</p>
<ul>

<li>

<p><b>/jdbc/driverClass</b></p>
<p>Nouvelle valeur : <tt>com.mysql.cj.jdbc.Driver</tt></p>
<p>Exemple :</p>

<div>
<div>
<pre class="source">&lt;Context&gt;
    ...
        &lt;Environment name=&quot;/jdbc/driverClass&quot; type=&quot;java.lang.String&quot; value=&quot;com.mysql.cj.jdbc.Driver&quot; override=&quot;false&quot;/&gt;
    ...
&lt;/Context&gt;
</pre></div></div>
</li>
<li>

<p><b>/codes/jdbc/driverClass</b></p>
<p>Nouvelle valeur : <tt>com.mysql.cj.jdbc.Driver</tt></p>
<p>Exemple :</p>

<div>
<div>
<pre class="source">&lt;Context&gt;
    ...
        &lt;Environment name=&quot;/codes/jdbc/driverClass&quot; type=&quot;java.lang.String&quot; value=&quot;com.mysql.cj.jdbc.Driver&quot; override=&quot;false&quot;/&gt;
    ...
&lt;/Context&gt;    
</pre></div></div>
</li>
<li>

<p><b>/interfacages/jdbc/driverClass</b></p>
<p>Nouvelle valeur : <tt>com.mysql.cj.jdbc.Driver</tt></p>
<p>Exemple :</p>

<div>
<div>
<pre class="source">&lt;Context&gt;
    ...
        &lt;Environment name=&quot;/interfacages/jdbc/driverClass&quot; type=&quot;java.lang.String&quot; value=&quot;com.mysql.cj.jdbc.Driver&quot; override=&quot;false&quot;/&gt;
    ...
&lt;/Context&gt;  
</pre></div></div>
</li>
<li>

<p><b>/jdbc/dialect</b></p>
<p>Nouvelle valeur : <tt>org.hibernate.dialect.MySQL5Dialect</tt></p>
<p>Exemple :</p>

<div>
<div>
<pre class="source">&lt;Context&gt;
    ...
        &lt;Environment name=&quot;/jdbc/dialect&quot; type=&quot;java.lang.String&quot; value=&quot;org.hibernate.dialect.MySQL5Dialect&quot; override=&quot;false&quot;/&gt;
    ...
&lt;/Context&gt;
</pre></div></div>
</li>
<li>

<p><b>/codes/jdbc/dialect</b></p>
<p>Nouvelle valeur : <tt>org.hibernate.dialect.MySQL5Dialect</tt></p>
<p>Exemple :</p>

<div>
<div>
<pre class="source">&lt;Context&gt;
    ...
        &lt;Environment name=&quot;/codes/jdbc/dialect&quot; type=&quot;java.lang.String&quot; value=&quot;org.hibernate.dialect.MySQL5Dialect&quot; override=&quot;false&quot;/&gt;
    ...
&lt;/Context&gt;    
</pre></div></div>
</li>
<li>

<p><b>/interfacages/jdbc/dialect</b></p>
<p>Nouvelle valeur : <tt>org.hibernate.dialect.MySQL5Dialect</tt></p>
<p>Exemple :</p>

<div>
<div>
<pre class="source">&lt;Context&gt;
    ...
        &lt;Environment name=&quot;/interfacages/jdbc/dialect&quot; type=&quot;java.lang.String&quot; value=&quot;org.hibernate.dialect.MySQL5Dialect&quot; override=&quot;false&quot;/&gt;
    ...
&lt;/Context&gt;  
</pre></div></div>
</li>
<li>

<p><b>/jdbc/url</b></p>
<p>Ajouter un param&#xe8;tre &#xe0; la fin de l&#x2019;URL : <tt>&amp;amp;serverTimezone=Europe/Paris</tt></p>
<p>Exemple :</p>

<div>
<div>
<pre class="source">&lt;Context&gt;
    ...
        &lt;Environment name=&quot;/jdbc/url&quot; type=&quot;java.lang.String&quot; value=&quot;jdbc:mysql://localhost:3306/tumorotek?characterEncoding=UTF-8&amp;amp;rewriteBatchedStatements=true&amp;amp;serverTimezone=Europe/Paris&quot; override=&quot;false&quot;/&gt;
    ...
&lt;/Context&gt;  
</pre></div></div>
</li>
<li>

<p><b>/codes/jdbc/url</b></p>
<p>Ajouter un param&#xe8;tre &#xe0; la fin de l&#x2019;URL : <tt>&amp;amp;serverTimezone=Europe/Paris</tt></p>
<p>Exemple :</p>

<div>
<div>
<pre class="source">&lt;Context&gt;
    ...
        &lt;Environment name=&quot;/codes/jdbc/url&quot; type=&quot;java.lang.String&quot; value=&quot;jdbc:mysql://localhost:3306/tumorotek_codes?characterEncoding=UTF-8&amp;amp;serverTimezone=Europe/Paris&quot; override=&quot;false&quot;/&gt;
    ...
&lt;/Context&gt;  
</pre></div></div>
</li>
<li>

<p><b>/interfacages/jdbc/url</b></p>
<p>Ajouter un param&#xe8;tre &#xe0; la fin de l&#x2019;URL : <tt>&amp;amp;serverTimezone=Europe/Paris</tt></p>
<p>Exemple :</p>

<div>
<div>
<pre class="source">&lt;Context&gt;
    ...
        &lt;Environment name=&quot;/interfacages/jdbc/url&quot; type=&quot;java.lang.String&quot; value=&quot;jdbc:mysql://localhost:3306/tumorotek_interfacages?characterEncoding=UTF-8&amp;amp;serverTimezone=Europe/Paris&quot; override=&quot;false&quot;/&gt;
    ...
&lt;/Context&gt; 
</pre></div></div>
</li>
</ul>
</li>
<li>

<p>T&#xe9;l&#xe9;charger le <a class="externalLink" href="https://github.com/TumoroteK/TumoroteK/releases/download/v2.2.3/tumorotek-install-2.2.3.zip">Dossier d&#x2019;installation</a></p>
</li>
<li>

<p>D&#xe9;zipper le dossier</p>
</li>
<li>

<p>Copier/d&#xe9;placer l&#x2019;archive <tt>tumorotek##2.2.3.war</tt> sur le serveur Tomcat dans le dossier <tt>&lt;PATH_TOMCAT&gt;/webapps</tt></p>
<p><span class="fas fa-exclamation-triangle" aria-hidden="true"></span> A partir de cette version, la configuration de l&#x2019;application est port&#xe9;e par le fichier <tt>&lt;PATH_TOMCAT&gt;/conf/Catalina/localhost/tumorotek.properties</tt>.<br />
A cette &#xe9;tape de l&#x2019;installation, le contenu du fichier <tt>tumorotek##2.2.3.xml</tt> est automatiquement report&#xe9; dans <tt>tumorotek.properties</tt> et le fichier <tt>tumorotek##2.2.3.xml</tt> est supprim&#xe9;.</p>
<p><span class="fas fa-exclamation-triangle" aria-hidden="true"></span> Si l&#x2019;authentification LDAP est utilis&#xe9;e, remplacer la ligne du fichier <tt>&lt;PATH_TOMCAT&gt;/conf/Catalina/localhost/tumorotek.properties</tt> suivante</p>

<div>
<div>
<pre class="source">ldap.authentication = false
</pre></div></div>

<p>par</p>

<div>
<div>
<pre class="source">ldap.authentication = true
</pre></div></div>
</li>
<li>

<p>Dans le Manager du Tomcat <tt>http://&lt;SERVEUR&gt;:8080/manager/html</tt> v&#xe9;rifier que l&#x2019;application dans sa derni&#xe8;re version est bien d&#xe9;ploy&#xe9;e et d&#xe9;marr&#xe9;e</p>
<ul>

<li>Si OK et si les utilisateurs se sont d&#xe9;connect&#xe9;s, vous pouvez retirer l&#x2019;ancienne version de TumoroteK depuis l&#x2019;interface du Manager</li>
<li>Si KO, analyser les logs dans le dossier <tt>&lt;PATH_TOMCAT&gt;/logs</tt> :
<ul>

<li>localhost.xxx.log</li>
<li>catalina.xxx.log</li>
<li>tumorotek_trace.log</li>
</ul>
</li>
</ul>
<blockquote>

<p>Si vous n&#x2019;arrivez pas &#xe0; r&#xe9;soudre le probl&#xe8;me, l&#x2019;ancienne version de TumoroteK devrait &#xea;tre active.</p>
</blockquote>
</li>
</ol></div></div></div></div>
        </div>
      </div>
    </div>
    <hr/>
    <footer>
      <div class="container-fluid">
        <div class="row-fluid">
            <p>Copyright &copy;2021.
All rights reserved.</p>
        </div>
      </div>
    </footer>
  </body>
</html>
