name: Build TK On Linux

on:
  push:
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v2

      # Set up Java
      - name: Set up JDK 8
        uses: actions/setup-java@v2
        with:
          java-version: '8'
          distribution: 'temurin'

      # Create Maven Wrapper
      - name: Create Maven Wrapper
        run: mvn wrapper:wrapper

      # Cache Maven dependencies
      - name: Cache Maven dependencies
        uses: actions/cache@v2
        with:
          path: ~/.m2/repository
          key: ${{ runner.os }}-m2-${{ hashFiles('**/pom.xml') }}
          restore-keys: |
            ${{ runner.os }}-m2-

      # Install Missing JAR: Oracle JDBC
      - name: Install Oracle JDBC driver to local repository
        run: |
          wget -O ojdbc6-11.2.0.4.jar https://repo1.maven.org/maven2/com/oracle/database/jdbc/ojdbc6/11.2.0.4/ojdbc6-11.2.0.4.jar
          ./mvnw install:install-file -Dfile=ojdbc6-11.2.0.4.jar -DgroupId=oracle -DartifactId=ojdbc6 -Dversion=11.2.0.4 -Dpackaging=jar   

      # Make Maven Wrapper executable
      - name: Install Dependencies and Build
        run: |
          chmod +x ./mvnw
          ./mvnw clean install -DskipTests
        env:
          MAVEN_OPTS: -Dmaven.repo.local=$HOME/.m2/repository

      # Print contents of repository directory for debugging
      - name: Debug - List contents of repository
        run: ls -R $HOME/.m2/repository

      # Additional debugging steps
      - name: Debug - Print Maven version
        run: ./mvnw --version

      - name: Debug - Print Java version
        run: java -version

      - name: Debug - Print environment variables
        run: echo $MAVEN_OPTS

      - name: Debug - Print directory contents
        run: ls -R
